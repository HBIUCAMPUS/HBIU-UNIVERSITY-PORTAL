{% extends "base.html" %}
{% block content %}
<div class="row">
  <div class="col-md-12">

    <!-- Course Header (category removed) -->
    <div class="card mb-4">
      <div class="card-body">
        <h1 class="card-title h3 mb-0">{{ unit.title }}</h1>
      </div>
    </div>

    <!-- Hero Image Section -->
    <div class="card mb-4 position-relative overflow-hidden">
      <img
        src="{{ url_for('static', filename='images/learning.jpeg') }}"
        class="img-fluid w-100"
        alt="Learning"
        style="max-height:420px; object-fit:cover;"
      >
      <a href="{{ url_for('learning_interface', unit_id=unit.id) }}"
         class="btn btn-primary position-absolute top-50 start-50 translate-middle shadow px-4 py-2 rounded-pill fs-5">
        Continue Learning
      </a>
    </div>

    <!-- Announcements Section -->
    <div class="card mb-4">
      <div class="card-body">
        <h5>Announcements</h5>
        {% if announcements %}
          <ul class="mb-0">
            {% for a in announcements %}
              <li class="mb-2">
                <strong>{{ a.title }}</strong><br>
                <small class="text-muted">{{ a.created_at }}</small>
                <p class="mb-0">{{ a.body }}</p>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="text-muted mb-0">No announcements at this time.</p>
        {% endif %}
      </div>
    </div>

    <!-- Weekly Class + Attendance Section -->
    <div class="card mb-4">
      <div class="card-body">
        <h5 class="mb-3">Weekly Class</h5>

        <!-- Class Link (empty until lecturer adds) -->
        <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-3">
          <div>
            <small class="text-muted d-block">Live class link</small>
            {% if weekly_link %}
              <a href="{{ weekly_link }}" target="_blank" rel="noopener" class="fw-semibold">
                Join Class
              </a>
            {% else %}
              <span class="text-muted">No link yet â€” your lecturer will add it here.</span>
            {% endif %}
          </div>
        </div>

        <!-- Attendance Button -->
        <form method="post" action="{{ url_for('mark_attendance', unit_id=unit.id) }}">
          <button
            type="submit"
            class="btn btn-success"
            {% if not attendance_open %}disabled title="Attendance not open yet"{% endif %}>
            Mark Weekly Attendance
          </button>
          <small class="text-muted ms-2">
            {% if attendance_open %}
              Attendance is currently open.
            {% else %}
              Attendance will be opened by your lecturer.
            {% endif %}
          </small>
        </form>
      </div>
    </div>

  </div>
</div>

<!-- Styles -->
<style>
.card {
  border: none;
  box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
  margin-bottom: 1.5rem;
}

.card-title {
  color: #2c3e50;
  font-weight: 600;
}

.btn-primary {
  background-color: #4e73df;
  border-color: #4e73df;
}

.btn-primary:hover {
  background-color: #2e59d9;
  border-color: #2e59d9;
}

.btn-success {
  background-color: #1cc88a;
  border-color: #1cc88a;
}

.btn-success:hover {
  background-color: #17a673;
  border-color: #17a673;
}
</style>

<!-- Script (for dynamic UI behaviors or Bootstrap dependencies) -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Optional: simple alert if attendance button is disabled
    const attendanceBtn = document.querySelector('button[title="Attendance not open yet"]');
    if (attendanceBtn) {
      attendanceBtn.addEventListener('click', function (e) {
        e.preventDefault();
        alert("Attendance is not open yet. Please wait for your lecturer to enable it.");
      });
    }

    // Example hook: could be expanded later for dynamic announcements refresh, etc.
    console.log("Course page loaded successfully.");
  });
</script>

{% endblock %}
