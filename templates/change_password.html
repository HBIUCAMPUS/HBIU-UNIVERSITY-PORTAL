{% extends "base.html" %}
{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card card-accent p-4">
            <h4 class="mb-3">Change Password</h4>
            
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }} alert-dismissible fade show">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}

            <form method="post">
                <div class="mb-3">
                    <label class="form-label">Current Password</label>
                    <input type="password" class="form-control" name="current_password" required 
                           placeholder="Enter your current password">
                
                        </div>
                
                <div class="mb-3">
                    <label class="form-label">New Password</label>
                    <input type="password" class="form-control" name="new_password" required 
                           placeholder="Enter new password" id="newPassword">
                    <div class="password-strength mt-2">
                        <small class="text-muted">Password must contain:</small>
                        <ul class="list-unstyled mt-1">
                            <li id="length" class="text-danger"><small>✓ At least 8 characters</small></li>
                            <li id="uppercase" class="text-danger"><small>✓ One uppercase letter</small></li>
                            <li id="lowercase" class="text-danger"><small>✓ One lowercase letter</small></li>
                            <li id="number" class="text-danger"><small>✓ One number</small></li>
                            <li id="special" class="text-danger"><small>✓ One special character</small></li>
                        </ul>
                    </div>
                </div>
                
                <div class="mb-3">
                    <label class="form-label">Confirm New Password</label>
                    <input type="password" class="form-control" name="confirm_password" required 
                           placeholder="Confirm new password" id="confirmPassword">
                    <div id="passwordMatch" class="mt-1"></div>
                </div>
                
                <div class="d-grid gap-2">
                    <button type="submit" class="btn btn-royal-blue">Change Password</button>
                    <a href="{{ url_for('student_dashboard' if session.user_type == 'student' else 'lecturer_dashboard') }}" 
                       class="btn btn-outline-secondary">Cancel</a>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const newPassword = document.getElementById('newPassword');
    const confirmPassword = document.getElementById('confirmPassword');
    const requirements = {
        length: document.getElementById('length'),
        uppercase: document.getElementById('uppercase'),
        lowercase: document.getElementById('lowercase'),
        number: document.getElementById('number'),
        special: document.getElementById('special')
    };
    const matchIndicator = document.getElementById('passwordMatch');

    function checkPasswordStrength(password) {
        // Check length
        requirements.length.className = password.length >= 8 ? 'text-success' : 'text-danger';
        
        // Check uppercase
        requirements.uppercase.className = /[A-Z]/.test(password) ? 'text-success' : 'text-danger';
        
        // Check lowercase
        requirements.lowercase.className = /[a-z]/.test(password) ? 'text-success' : 'text-danger';
        
        // Check number
        requirements.number.className = /\d/.test(password) ? 'text-success' : 'text-danger';
        
        // Check special character
        requirements.special.className = /[!@#$%^&*(),.?":{}|<>]/.test(password) ? 'text-success' : 'text-danger';
    }

    function checkPasswordMatch() {
        if (confirmPassword.value === '') {
            matchIndicator.innerHTML = '';
        } else if (newPassword.value === confirmPassword.value) {
            matchIndicator.innerHTML = '<small class="text-success">✓ Passwords match</small>';
        } else {
            matchIndicator.innerHTML = '<small class="text-danger">✗ Passwords do not match</small>';
        }
    }

    newPassword.addEventListener('input', function() {
        checkPasswordStrength(this.value);
        checkPasswordMatch();
    });

    confirmPassword.addEventListener('input', checkPasswordMatch);
});
</script>

<style>
.password-strength ul li small:before {
    content: "✗ ";
    font-weight: bold;
}
.password-strength ul li.text-success small:before {
    content: "✓ ";
    font-weight: bold;
}
</style>
{% endblock %}
